<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>üí∞ Î∂ÄÎ∂Ä Í≥µÏú† Í∞ÄÍ≥ÑÎ∂Ä</title>
    
    <!-- Firebase SDK (Firestore) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <!-- React -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            overflow-x: hidden;
            background: #e5e7eb;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            padding: 20px 0;
        }
        
        #root {
            width: 100%;
            max-width: 430px;
            min-height: 100vh;
            background: white;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            border-radius: 20px;
            overflow: hidden;
        }

        @media (max-width: 768px) {
            body {
                padding: 0;
                background: white;
            }
            #root {
                max-width: 100%;
                box-shadow: none;
                border-radius: 0;
            }
        }
        
        input[type="number"] {
            -moz-appearance: textfield;
        }
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        
        input[type="date"] {
            min-width: 110px;
        }
        
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        textarea {
            resize: none;
            overflow: hidden;
            min-height: 38px;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const firebaseConfig = {
            apiKey: "AIzaSyBJaXg-Ka_1MvjLWKP6yGVZqNWXkkMS65U",
            authDomain: "dasol-moneybook-b6446.firebaseapp.com",
            databaseURL: "https://dasol-moneybook-b6446-default-rtdb.firebaseio.com",
            projectId: "dasol-moneybook-b6446",
            storageBucket: "dasol-moneybook-b6446.firebasestorage.app",
            messagingSenderId: "104376867541",
            appId: "1:104376867541:web:f2b9db7a060f23d888a05c"
        };

        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.firestore();

        // ÏïÑÏù¥ÏΩò Ïª¥Ìè¨ÎÑåÌä∏Îì§
        const ChevronDown = ({ size = 24 }) => (
            React.createElement('svg', {
                width: size, height: size, viewBox: "0 0 24 24", fill: "none",
                stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round"
            }, React.createElement('polyline', { points: "6 9 12 15 18 9" }))
        );

        const ChevronUp = ({ size = 24 }) => (
            React.createElement('svg', {
                width: size, height: size, viewBox: "0 0 24 24", fill: "none",
                stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round"
            }, React.createElement('polyline', { points: "18 15 12 9 6 15" }))
        );

        const Plus = ({ size = 24 }) => (
            React.createElement('svg', {
                width: size, height: size, viewBox: "0 0 24 24", fill: "none",
                stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round"
            },
                React.createElement('line', { x1: "12", y1: "5", x2: "12", y2: "19" }),
                React.createElement('line', { x1: "5", y1: "12", x2: "19", y2: "12" })
            )
        );

        const Trash2 = ({ size = 20 }) => (
            React.createElement('svg', {
                width: size, height: size, viewBox: "0 0 24 24", fill: "none",
                stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round"
            },
                React.createElement('polyline', { points: "3 6 5 6 21 6" }),
                React.createElement('path', { d: "M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" }),
                React.createElement('line', { x1: "10", y1: "11", x2: "10", y2: "17" }),
                React.createElement('line', { x1: "14", y1: "11", x2: "14", y2: "17" })
            )
        );

        const Settings = ({ size = 20 }) => (
            React.createElement('svg', {
                width: size, height: size, viewBox: "0 0 24 24", fill: "none",
                stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round"
            },
                React.createElement('circle', { cx: "12", cy: "12", r: "3" }),
                React.createElement('path', { d: "M12 1v6m0 6v6m-5-7l5-5m0 10l5-5m-10-5l5 5m0 0l5-5m-10 10l5-5m0 0l5 5" })
            )
        );

        function Household() {
            const [activeMonth, setActiveMonth] = useState('25ÎÖÑ11Ïõî');
            const [monthData, setMonthData] = useState({});
            const [isFixedExpanded, setIsFixedExpanded] = useState(true);
            const [isExpenseExpanded, setIsExpenseExpanded] = useState(true);
            const [isIncomeExpanded, setIsIncomeExpanded] = useState(true);
            const [months, setMonths] = useState([]);
            const [showMonthManage, setShowMonthManage] = useState(false);
            const [newMonthYear, setNewMonthYear] = useState('25');
            const [newMonthMonth, setNewMonthMonth] = useState('01');
            const [editingItems, setEditingItems] = useState({});
            const [isLoading, setIsLoading] = useState(true);

            // Î°úÏª¨ ÏÉÅÌÉú Í¥ÄÎ¶¨ (ÌïúÍ∏Ä ÏûÖÎ†•Ïö©)
            const [localData, setLocalData] = useState({});
            const saveTimeoutRef = useRef({});

            useEffect(() => {
                const unsubscribe = db.collection('household').onSnapshot((snapshot) => {
                    const data = {};
                    const monthsList = [];
                    
                    snapshot.forEach((doc) => {
                        const monthName = doc.id;
                        monthsList.push(monthName);
                        data[monthName] = doc.data();
                    });

                    if (monthsList.length === 0) {
                        const initialMonths = ['25ÎÖÑ11Ïõî', '25ÎÖÑ12Ïõî', '26ÎÖÑ01Ïõî'];
                        const initialData = {
                            fixed: [],
                            expense: [],
                            income: []
                        };

                        initialMonths.forEach(month => {
                            db.collection('household').doc(month).set(initialData);
                        });
                    } else {
                        monthsList.sort((a, b) => {
                            const [aYear, aMonth] = a.replace('ÎÖÑ', '-').replace('Ïõî', '').split('-');
                            const [bYear, bMonth] = b.replace('ÎÖÑ', '-').replace('Ïõî', '').split('-');
                            return parseInt(aYear + aMonth) - parseInt(bYear + bMonth);
                        });

                        setMonths(monthsList);
                        setMonthData(data);
                        setLocalData(data);
                        setIsLoading(false);
                    }
                });

                return () => unsubscribe();
            }, []);

            const currentData = localData[activeMonth] || { fixed: [], expense: [], income: [] };

            const sortByDate = (items, type) => {
                // Ìé∏Ïßë Ï§ëÏù∏ Ìï≠Î™©Ïù¥ ÏûàÏúºÎ©¥ Ï†ïÎ†¨ÌïòÏßÄ ÏïäÏùå
                const hasEditing = items.some(item => editingItems[`${type}-${item.id}`]);
                if (hasEditing) {
                    return items;
                }
                
                return [...items].sort((a, b) => {
                    if (!a.date && !b.date) return 0;
                    if (!a.date) return 1;
                    if (!b.date) return -1;
                    
                    const dateA = new Date(a.date);
                    const dateB = new Date(b.date);
                    return dateA - dateB;
                });
            };

            const formatNumber = (num) => {
                if (!num) return '0';
                return parseInt(num).toLocaleString('ko-KR');
            };

            const calculateTotal = (items) => {
                return items.reduce((sum, item) => sum + (parseInt(item.amount) || 0), 0);
            };

            const saveToFirebase = (field, updatedData) => {
                const key = `${activeMonth}-${field}`;
                
                if (saveTimeoutRef.current[key]) {
                    clearTimeout(saveTimeoutRef.current[key]);
                }

                saveTimeoutRef.current[key] = setTimeout(() => {
                    db.collection('household').doc(activeMonth).update({ [field]: updatedData })
                        .then(() => console.log('Ï†ÄÏû• ÏôÑÎ£å'))
                        .catch(err => console.error('Ï†ÄÏû• Ïã§Ìå®:', err));
                }, 1000);
            };

            const addMonth = () => {
                const monthFormatted = newMonthMonth.toString().padStart(2, '0');
                const newMonth = `${newMonthYear}ÎÖÑ${monthFormatted}Ïõî`;
                if (!months.includes(newMonth)) {
                    db.collection('household').doc(newMonth).set({
                        fixed: [],
                        expense: [],
                        income: []
                    });
                    setNewMonthYear('25');
                    setNewMonthMonth('01');
                }
            };

            const deleteMonth = (month) => {
                if (months.length <= 1) {
                    alert('ÎßàÏßÄÎßâ ÏõîÏùÄ ÏÇ≠Ï†úÌï† Ïàò ÏóÜÏäµÎãàÎã§.');
                    return;
                }
                if (window.confirm(`${month}ÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?`)) {
                    db.collection('household').doc(month).delete();
                    if (activeMonth === month) {
                        const index = months.indexOf(month);
                        const newActiveMonth = months[index === 0 ? 1 : index - 1];
                        setActiveMonth(newActiveMonth);
                    }
                }
            };

            const addFixed = () => {
                const newFixed = {
                    id: Date.now(),
                    date: '',
                    content: '',
                    amount: ''
                };
                const updated = [...currentData.fixed, newFixed];
                setLocalData({
                    ...localData,
                    [activeMonth]: { ...currentData, fixed: updated }
                });
                db.collection('household').doc(activeMonth).update({ fixed: updated });
                setEditingItems({ ...editingItems, [`fixed-${newFixed.id}`]: true });
            };

            const updateFixed = (id, field, value) => {
                const updated = currentData.fixed.map(item =>
                    item.id === id ? { ...item, [field]: value } : item
                );
                setLocalData({
                    ...localData,
                    [activeMonth]: { ...currentData, fixed: updated }
                });
                saveToFirebase('fixed', updated);
            };

            const deleteFixed = (id) => {
                if (window.confirm('ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                    const updated = currentData.fixed.filter(item => item.id !== id);
                    setLocalData({
                        ...localData,
                        [activeMonth]: { ...currentData, fixed: updated }
                    });
                    db.collection('household').doc(activeMonth).update({ fixed: updated });
                }
            };

            const addExpense = () => {
                const newExpense = {
                    id: Date.now(),
                    date: '',
                    content: '',
                    amount: ''
                };
                const updated = [...currentData.expense, newExpense];
                setLocalData({
                    ...localData,
                    [activeMonth]: { ...currentData, expense: updated }
                });
                db.collection('household').doc(activeMonth).update({ expense: updated });
                setEditingItems({ ...editingItems, [`expense-${newExpense.id}`]: true });
            };

            const updateExpense = (id, field, value) => {
                const updated = currentData.expense.map(item =>
                    item.id === id ? { ...item, [field]: value } : item
                );
                setLocalData({
                    ...localData,
                    [activeMonth]: { ...currentData, expense: updated }
                });
                saveToFirebase('expense', updated);
            };

            const deleteExpense = (id) => {
                if (window.confirm('ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                    const updated = currentData.expense.filter(item => item.id !== id);
                    setLocalData({
                        ...localData,
                        [activeMonth]: { ...currentData, expense: updated }
                    });
                    db.collection('household').doc(activeMonth).update({ expense: updated });
                }
            };

            const addIncome = () => {
                const newIncome = {
                    id: Date.now(),
                    date: '',
                    content: '',
                    amount: ''
                };
                const updated = [...currentData.income, newIncome];
                setLocalData({
                    ...localData,
                    [activeMonth]: { ...currentData, income: updated }
                });
                db.collection('household').doc(activeMonth).update({ income: updated });
                setEditingItems({ ...editingItems, [`income-${newIncome.id}`]: true });
            };

            const updateIncome = (id, field, value) => {
                const updated = currentData.income.map(item =>
                    item.id === id ? { ...item, [field]: value } : item
                );
                setLocalData({
                    ...localData,
                    [activeMonth]: { ...currentData, income: updated }
                });
                saveToFirebase('income', updated);
            };

            const deleteIncome = (id) => {
                if (window.confirm('ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                    const updated = currentData.income.filter(item => item.id !== id);
                    setLocalData({
                        ...localData,
                        [activeMonth]: { ...currentData, income: updated }
                    });
                    db.collection('household').doc(activeMonth).update({ income: updated });
                }
            };

            const toggleEdit = (type, id) => {
                const key = `${type}-${id}`;
                setEditingItems({ ...editingItems, [key]: !editingItems[key] });
            };

            const completeEdit = (type, id) => {
                const key = `${type}-${id}`;
                setEditingItems({ ...editingItems, [key]: false });
            };

            const fixedTotal = calculateTotal(currentData.fixed);
            const expenseTotal = calculateTotal(currentData.expense);
            const incomeTotal = calculateTotal(currentData.income);
            const balance = incomeTotal - fixedTotal - expenseTotal;

            if (isLoading) {
                return (
                    <div className="flex items-center justify-center h-screen bg-gray-50">
                        <div className="text-center">
                            <div className="text-4xl mb-4">üí∞</div>
                            <div className="text-xl font-bold text-gray-700">Î°úÎî© Ï§ë...</div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gray-50 pb-20">
                    {/* Ìó§Îçî */}
                    <div className="sticky top-0 bg-gradient-to-r from-purple-600 to-blue-600 text-white shadow-lg z-20">
                        <div className="px-4 py-4">
                            <div className="flex items-center justify-between mb-3">
                                <h1 className="text-2xl font-bold">üí∞ Î∂ÄÎ∂Ä Í≥µÏú† Í∞ÄÍ≥ÑÎ∂Ä</h1>
                                <button
                                    onClick={() => setShowMonthManage(!showMonthManage)}
                                    className="p-2 bg-white bg-opacity-20 rounded-lg hover:bg-opacity-30 transition-colors"
                                >
                                    <Settings size={20} />
                                </button>
                            </div>
                            
                            <div className="flex gap-2 overflow-x-auto pb-2 scrollbar-hide">
                                {months.map(month => (
                                    <button
                                        key={month}
                                        onClick={() => setActiveMonth(month)}
                                        className={`flex-shrink-0 px-4 py-2 rounded-lg font-bold text-sm transition-all ${
                                            activeMonth === month
                                                ? 'bg-white text-purple-600 shadow-lg scale-105'
                                                : 'bg-purple-700 hover:bg-purple-800'
                                        }`}
                                    >
                                        {month}
                                    </button>
                                ))}
                            </div>

                            {showMonthManage && (
                                <div className="mt-3 p-4 bg-white rounded-lg text-black">
                                    <h3 className="font-bold mb-3 text-lg">Ïõî Í¥ÄÎ¶¨</h3>
                                    
                                    <div className="mb-4">
                                        <label className="block text-sm font-bold mb-2">ÏÉà Ïõî Ï∂îÍ∞Ä</label>
                                        <div className="flex gap-2 items-center">
                                            <input
                                                type="number"
                                                value={newMonthYear}
                                                onChange={(e) => setNewMonthYear(e.target.value)}
                                                onFocus={(e) => e.target.select()}
                                                placeholder="ÎÖÑ"
                                                className="w-20 px-3 py-2 border rounded-lg text-center"
                                            />
                                            <span className="font-bold">ÎÖÑ</span>
                                            <input
                                                type="number"
                                                value={newMonthMonth}
                                                onChange={(e) => setNewMonthMonth(e.target.value)}
                                                onFocus={(e) => e.target.select()}
                                                placeholder="Ïõî"
                                                min="1"
                                                max="12"
                                                className="w-20 px-3 py-2 border rounded-lg text-center"
                                            />
                                            <span className="font-bold">Ïõî</span>
                                            <button
                                                onClick={addMonth}
                                                className="flex-1 px-4 py-2 bg-green-500 text-white rounded-lg font-bold hover:bg-green-600"
                                            >
                                                Ï∂îÍ∞Ä
                                            </button>
                                        </div>
                                    </div>

                                    <div>
                                        <label className="block text-sm font-bold mb-2">Ïõî ÏÇ≠Ï†ú</label>
                                        <div className="space-y-2 max-h-40 overflow-y-auto">
                                            {months.map(month => (
                                                <div key={month} className="flex items-center justify-between p-2 bg-gray-50 rounded">
                                                    <span className="font-medium">{month}</span>
                                                    <button
                                                        onClick={() => deleteMonth(month)}
                                                        className="px-3 py-1 bg-red-500 text-white rounded text-sm hover:bg-red-600"
                                                    >
                                                        ÏÇ≠Ï†ú
                                                    </button>
                                                </div>
                                            ))}
                                        </div>
                                    </div>

                                    <button
                                        onClick={() => setShowMonthManage(false)}
                                        className="mt-4 w-full px-4 py-2 bg-gray-500 text-white rounded-lg font-bold hover:bg-gray-600"
                                    >
                                        Îã´Í∏∞
                                    </button>
                                </div>
                            )}
                        </div>
                    </div>

                    {/* Î©îÏù∏ Ïª®ÌÖêÏ∏† */}
                    <div className="p-3">
                        {/* ÏöîÏïΩ Ïπ¥Îìú */}
                        <div className="grid grid-cols-3 gap-2 mb-3">
                            <div className="bg-green-100 rounded-xl p-3 shadow-lg border-2 border-green-200">
                                <div className="text-xs font-bold mb-1 text-green-800">ÌÜµÏû•ÏûîÏï°</div>
                                <div className="text-sm font-bold break-words leading-tight text-green-700">{formatNumber(balance)}Ïõê</div>
                            </div>
                            <div className="bg-red-100 rounded-xl p-3 shadow-lg border-2 border-red-200">
                                <div className="text-xs font-bold mb-1 text-red-800">ÏßÄÏ∂úÌï©Í≥Ñ</div>
                                <div className="text-sm font-bold break-words leading-tight text-red-700">{formatNumber(fixedTotal + expenseTotal)}Ïõê</div>
                            </div>
                            <div className="bg-blue-100 rounded-xl p-3 shadow-lg border-2 border-blue-200">
                                <div className="text-xs font-bold mb-1 text-blue-800">ÏàòÏûÖÌï©Í≥Ñ</div>
                                <div className="text-sm font-bold break-words leading-tight text-blue-700">{formatNumber(incomeTotal)}Ïõê</div>
                            </div>
                        </div>

                        {/* Í≥†Ï†ï ÏßÄÏ∂ú ÏÑπÏÖò */}
                        <div className="bg-white shadow-lg rounded-2xl mb-3 overflow-hidden">
                            <button
                                onClick={() => setIsFixedExpanded(!isFixedExpanded)}
                                className="w-full px-4 py-3 flex items-center justify-between bg-purple-600 text-white hover:bg-purple-700 transition-colors"
                            >
                                <span className="text-lg font-bold">üè† Í≥†Ï†ïÏßÄÏ∂ú</span>
                                {isFixedExpanded ? <ChevronUp size={20} /> : <ChevronDown size={20} />}
                            </button>

                            {isFixedExpanded && (
                                <div className="p-3">
                                    <div className="space-y-2">
                                        {currentData.fixed.length === 0 ? (
                                            <div className="text-center py-8 text-gray-400 text-sm">
                                                Í≥†Ï†ï ÏßÄÏ∂ú ÎÇ¥Ïó≠Ïù¥ ÏóÜÏäµÎãàÎã§
                                            </div>
                                        ) : (
                                            sortByDate(currentData.fixed, 'fixed').map(item => {
                                                const isEditing = editingItems[`fixed-${item.id}`];
                                                return (
                                                    <div key={item.id} className="bg-purple-50 p-2 rounded-lg border border-purple-200">
                                                        <div className="flex gap-1 items-start mb-2">
                                                            <input
                                                                type="date"
                                                                value={item.date || ''}
                                                                onChange={(e) => updateFixed(item.id, 'date', e.target.value)}
                                                                className="w-28 px-1 py-2 border rounded text-xs flex-shrink-0"
                                                                disabled={!isEditing}
                                                            />
                                                            <button
                                                                onClick={() => deleteFixed(item.id)}
                                                                className="p-2 text-red-500 hover:bg-red-50 rounded flex-shrink-0"
                                                            >
                                                                <Trash2 size={16} />
                                                            </button>
                                                        </div>
                                                        <input
                                                            type="text"
                                                            value={item.content || ''}
                                                            onChange={(e) => updateFixed(item.id, 'content', e.target.value)}
                                                            placeholder="ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî"
                                                            className="w-full px-2 py-2 border rounded text-sm mb-2"
                                                            disabled={!isEditing}
                                                        />
                                                        <div className="flex gap-1 items-center">
                                                            {isEditing ? (
                                                                <input
                                                                    type="number"
                                                                    value={item.amount || ''}
                                                                    onChange={(e) => updateFixed(item.id, 'amount', e.target.value)}
                                                                    placeholder="Í∏àÏï°"
                                                                    className="flex-1 px-2 py-2 border rounded text-sm"
                                                                />
                                                            ) : (
                                                                <div className="flex-1 px-2 py-2 border rounded bg-gray-100 text-xs font-bold text-right">
                                                                    {formatNumber(item.amount)}Ïõê
                                                                </div>
                                                            )}
                                                            <button
                                                                onClick={() => isEditing ? completeEdit('fixed', item.id) : toggleEdit('fixed', item.id)}
                                                                className={`px-4 py-2 rounded font-bold text-xs ${
                                                                    isEditing 
                                                                        ? 'bg-green-500 text-white' 
                                                                        : 'bg-blue-500 text-white'
                                                                }`}
                                                            >
                                                                {isEditing ? 'ÏôÑÎ£å' : 'ÏàòÏ†ï'}
                                                            </button>
                                                        </div>
                                                    </div>
                                                );
                                            })
                                        )}
                                    </div>
                                    <button
                                        onClick={addFixed}
                                        className="mt-3 w-full flex items-center justify-center gap-2 px-4 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 font-bold"
                                    >
                                        <Plus size={20} />
                                        Í≥†Ï†ïÏßÄÏ∂ú Ï∂îÍ∞Ä
                                    </button>
                                </div>
                            )}
                        </div>

                        {/* ÏßÄÏ∂ú ÏÑπÏÖò */}
                        <div className="bg-white shadow-lg rounded-2xl mb-3 overflow-hidden">
                            <button
                                onClick={() => setIsExpenseExpanded(!isExpenseExpanded)}
                                className="w-full px-4 py-3 flex items-center justify-between bg-red-600 text-white hover:bg-red-700 transition-colors"
                            >
                                <span className="text-lg font-bold">üí∏ ÏßÄÏ∂ú</span>
                                {isExpenseExpanded ? <ChevronUp size={20} /> : <ChevronDown size={20} />}
                            </button>

                            {isExpenseExpanded && (
                                <div className="p-3">
                                    <div className="space-y-2">
                                        {currentData.expense.length === 0 ? (
                                            <div className="text-center py-8 text-gray-400 text-sm">
                                                ÏßÄÏ∂ú ÎÇ¥Ïó≠Ïù¥ ÏóÜÏäµÎãàÎã§
                                            </div>
                                        ) : (
                                            sortByDate(currentData.expense, 'expense').map(item => {
                                                const isEditing = editingItems[`expense-${item.id}`];
                                                return (
                                                    <div key={item.id} className="bg-red-50 p-2 rounded-lg border border-red-200">
                                                        <div className="flex gap-1 items-start mb-2">
                                                            <input
                                                                type="date"
                                                                value={item.date || ''}
                                                                onChange={(e) => updateExpense(item.id, 'date', e.target.value)}
                                                                className="w-28 px-1 py-2 border rounded text-xs flex-shrink-0"
                                                                disabled={!isEditing}
                                                            />
                                                            <button
                                                                onClick={() => deleteExpense(item.id)}
                                                                className="p-2 text-red-500 hover:bg-red-50 rounded flex-shrink-0"
                                                            >
                                                                <Trash2 size={16} />
                                                            </button>
                                                        </div>
                                                        <input
                                                            type="text"
                                                            value={item.content || ''}
                                                            onChange={(e) => updateExpense(item.id, 'content', e.target.value)}
                                                            placeholder="ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî"
                                                            className="w-full px-2 py-2 border rounded text-sm mb-2"
                                                            disabled={!isEditing}
                                                        />
                                                        <div className="flex gap-1 items-center">
                                                            {isEditing ? (
                                                                <input
                                                                    type="number"
                                                                    value={item.amount || ''}
                                                                    onChange={(e) => updateExpense(item.id, 'amount', e.target.value)}
                                                                    placeholder="Í∏àÏï°"
                                                                    className="flex-1 px-2 py-2 border rounded text-sm"
                                                                />
                                                            ) : (
                                                                <div className="flex-1 px-2 py-2 border rounded bg-gray-100 text-xs font-bold text-right">
                                                                    {formatNumber(item.amount)}Ïõê
                                                                </div>
                                                            )}
                                                            <button
                                                                onClick={() => isEditing ? completeEdit('expense', item.id) : toggleEdit('expense', item.id)}
                                                                className={`px-4 py-2 rounded font-bold text-xs ${
                                                                    isEditing 
                                                                        ? 'bg-green-500 text-white' 
                                                                        : 'bg-blue-500 text-white'
                                                                }`}
                                                            >
                                                                {isEditing ? 'ÏôÑÎ£å' : 'ÏàòÏ†ï'}
                                                            </button>
                                                        </div>
                                                    </div>
                                                );
                                            })
                                        )}
                                    </div>
                                    <button
                                        onClick={addExpense}
                                        className="mt-3 w-full flex items-center justify-center gap-2 px-4 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 font-bold"
                                    >
                                        <Plus size={20} />
                                        ÏßÄÏ∂ú Ï∂îÍ∞Ä
                                    </button>
                                </div>
                            )}
                        </div>

                        {/* ÏàòÏûÖ ÏÑπÏÖò */}
                        <div className="bg-white shadow-lg rounded-2xl mb-3 overflow-hidden">
                            <button
                                onClick={() => setIsIncomeExpanded(!isIncomeExpanded)}
                                className="w-full px-4 py-3 flex items-center justify-between bg-blue-600 text-white hover:bg-blue-700 transition-colors"
                            >
                                <span className="text-lg font-bold">üíµ ÏàòÏûÖ</span>
                                {isIncomeExpanded ? <ChevronUp size={20} /> : <ChevronDown size={20} />}
                            </button>

                            {isIncomeExpanded && (
                                <div className="p-3">
                                    <div className="space-y-2">
                                        {currentData.income.length === 0 ? (
                                            <div className="text-center py-8 text-gray-400 text-sm">
                                                ÏàòÏûÖ ÎÇ¥Ïó≠Ïù¥ ÏóÜÏäµÎãàÎã§
                                            </div>
                                        ) : (
                                            sortByDate(currentData.income, 'income').map(item => {
                                                const isEditing = editingItems[`income-${item.id}`];
                                                return (
                                                    <div key={item.id} className="bg-blue-50 p-2 rounded-lg border border-blue-200">
                                                        <div className="flex gap-1 items-start mb-2">
                                                            <input
                                                                type="date"
                                                                value={item.date || ''}
                                                                onChange={(e) => updateIncome(item.id, 'date', e.target.value)}
                                                                className="w-28 px-1 py-2 border rounded text-xs flex-shrink-0"
                                                                disabled={!isEditing}
                                                            />
                                                            <button
                                                                onClick={() => deleteIncome(item.id)}
                                                                className="p-2 text-red-500 hover:bg-red-50 rounded flex-shrink-0"
                                                            >
                                                                <Trash2 size={16} />
                                                            </button>
                                                        </div>
                                                        <input
                                                            type="text"
                                                            value={item.content || ''}
                                                            onChange={(e) => updateIncome(item.id, 'content', e.target.value)}
                                                            placeholder="ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî"
                                                            className="w-full px-2 py-2 border rounded text-sm mb-2"
                                                            disabled={!isEditing}
                                                        />
                                                        <div className="flex gap-1 items-center">
                                                            {isEditing ? (
                                                                <input
                                                                    type="number"
                                                                    value={item.amount || ''}
                                                                    onChange={(e) => updateIncome(item.id, 'amount', e.target.value)}
                                                                    placeholder="Í∏àÏï°"
                                                                    className="flex-1 px-2 py-2 border rounded text-sm"
                                                                />
                                                            ) : (
                                                                <div className="flex-1 px-2 py-2 border rounded bg-gray-100 text-xs font-bold text-right">
                                                                    {formatNumber(item.amount)}Ïõê
                                                                </div>
                                                            )}
                                                            <button
                                                                onClick={() => isEditing ? completeEdit('income', item.id) : toggleEdit('income', item.id)}
                                                                className={`px-4 py-2 rounded font-bold text-xs ${
                                                                    isEditing 
                                                                        ? 'bg-green-500 text-white' 
                                                                        : 'bg-blue-500 text-white'
                                                                }`}
                                                            >
                                                                {isEditing ? 'ÏôÑÎ£å' : 'ÏàòÏ†ï'}
                                                            </button>
                                                        </div>
                                                    </div>
                                                );
                                            })
                                        )}
                                    </div>
                                    <button
                                        onClick={addIncome}
                                        className="mt-3 w-full flex items-center justify-center gap-2 px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-bold"
                                    >
                                        <Plus size={20} />
                                        ÏàòÏûÖ Ï∂îÍ∞Ä
                                    </button>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<Household />);
    </script>
</body>
</html>
